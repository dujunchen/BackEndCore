### 压缩列表
1. 压缩列表是redis为了节约内存设计的。是由一系列特殊编码的连续内存块组成的顺序数据结构。

2. redis中的列表键或者hash键只包含少量列表项或者少量键值对，并且每个列表项或者键值对的键和值都是小整数值或者短字符串时，采用压缩列表实现列表键和hash键。

3. 压缩列表组成：

   - zlbytes：记录整个压缩列表的占用字节数。

   - zltail：记录压缩类表表尾节点距离列表起始地址的字节数。

   - zllen：记录压缩列表中节点数量。当等于UNIT16_MAX（65535）时，需要遍历整个压缩列表确定节点数量。

   - entryX：列表节点
     压缩列表节点属性：previous_entry_length、encoding、content。

     1. previous_entry_length表示上一个节点的长度。该属性长度可以是1个字节或者5个字节。如果前一个节点长度<254字节，那么该属性长度为1个字节。如果前一个节点长度>=254字节，那么该属性长度为5个字节。其中第一个字节设置为0xFE，表示这个是5字节属性。后面4个字节用于保存前一节点长度值。可以通过当前节点的起始地址减去当前节点的previous_entry_length计算出前一个节点的起始地址。可以使用这一原理实现压缩列表的从表尾向表头遍历操作。

     2. encoding记录节点的content保存数据的类型和长度。

        字节数组编码：

        | 编码   | 编码长度(字节) | content值                  |
        | ------ | -------------- | -------------------------- |
        | 00开头 | 1              | 长度<=2^6-1字节的字节数组  |
        | 01开头 | 2              | 长度<=2^14-1字节的字节数组 |
        | 10开头 | 5              | 长度<=2^32-1字节的字节数组 |

        整数编码：

        最高位以11开头，编码长度1个字节，可以保存int16、int32、int64等类型整数。

     3. content负责保存节点的值。

   - zlend：特殊值0xFF，表示压缩列表的结束。

4. 连锁更新

   - 在一个压缩列表中多个连续长度<254字节的节点，在表头位置插入一个长度>=254新节点或在一个压缩列表中，删除一个位于big节点(长度>=254)和连续小节点(长度<254字节)之间的节点，导致后继的节点previous_entry_length属性长度不够(原先是1个字节就可以，现在需要扩展到5个字节)，程序需要不断的对压缩列表执行内存重分配操作，直至最后一个节点。
   - 最坏情况下N个节点的压缩列表需要执行N次内存重分配，而每次重分配需要对所有的节点操作，复杂度O(N)，所以连锁更新最坏复杂O(N^2)。
   - 连锁更新复杂度较高，不过造成性能问题概率较低。因为需要恰好多个连续长度<254字节的节点才会引发，这种情况不多见。另外，只要节点数量不多，即使出现连锁更新也不会影响性能。平均复杂度为O(N)